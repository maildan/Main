# 모듈 감사 가이드

## 소개

Loop 프로젝트의 모듈 감사 도구는 코드베이스의 건강 상태를 평가하고 개선 가능한 영역을 식별하는 강력한 유틸리티입니다. 이 도구는 다음과 같은 핵심 기능을 제공합니다:

- 사용되지 않는 모듈 감지
- 큰 크기의 모듈 식별
- 깊은 종속성 체인 분석
- 자동 수정 가능한 문제 파악
- 상세한 보고서 생성

## 설치 요구사항

모듈 감사 스크립트를 실행하기 전에 다음 종속성이 필요합니다:

```bash
yarn add --dev chalk ora yargs
```

추가적으로 종속성 분석을 위해 다음 도구를 설치하는 것이 좋습니다:

```bash
yarn add --dev madge dependency-cruiser
```

## 기본 사용법

가장 기본적인 형태로 다음과 같이 실행할 수 있습니다:

```bash
node scripts/module-audit.js
```

이 명령은 기본 옵션으로 `src` 디렉터리를 감사하고 결과를 `module-audit-report.json` 파일에 저장합니다.

## 명령줄 옵션

| 옵션 | 단축어 | 설명 | 기본값 |
|------|--------|------|--------|
| `--dir` | `-d` | 감사할 디렉터리 | `src` |
| `--output` | `-o` | 출력 파일 경로 | `module-audit-report.json` |
| `--threshold` | `-t` | 큰 모듈 경고 임계값(KB) | `500` |
| `--verbose` | `-v` | 상세 로그 출력 | `false` |
| `--fix` | `-f` | 자동 수정 적용 시도 | `false` |
| `--help` | `-h` | 도움말 표시 | - |

## 사용 예시

### 특정 디렉터리 분석

```bash
node scripts/module-audit.js --dir src/app
```

### 큰 모듈 임계값 조정

```bash
node scripts/module-audit.js --threshold 200
```

### 자동 수정 적용

```bash
node scripts/module-audit.js --fix
```

### 상세 로그 출력과 함께 실행

```bash
node scripts/module-audit.js --verbose
```

### 출력 파일 경로 지정

```bash
node scripts/module-audit.js --output reports/modules.json
```

## 결과 해석

### 사용되지 않는 모듈

사용되지 않는 모듈은 다른 파일에서 임포트되지 않는 모듈입니다. 이러한 모듈은 다음과 같은 이유로 존재할 수 있습니다:

- 프로젝트에서 더 이상 필요하지 않은 레거시 코드
- 임시 실험 파일
- 실제로는 사용되지만 도구에서 감지하지 못한 경우 (동적 임포트 등)

**권장 조치**: 사용되지 않는 모듈을 검토하고 불필요한 경우 제거하세요.

### 큰 모듈

큰 모듈은 지정된 임계값(기본값: 500KB)보다 큰 파일입니다. 이러한 모듈은 다음과 같은 문제를 일으킬 수 있습니다:

- 로딩 및 파싱 시간 증가
- 메모리 사용량 증가
- 코드 이해도 및 유지보수성 저하

**권장 조치**: 큰 모듈을 여러 작은 모듈로 분리하는 것을 고려하세요.

### 깊은 종속성 체인

깊은 종속성 체인은 모듈이 다른 모듈을 임포트하고, 그 모듈이 또 다른 모듈을 임포트하는 등 긴 체인을 형성하는 경우입니다. 이는 다음과 같은 문제를 일으킬 수 있습니다:

- 코드 이해도 저하
- 코드 변경의 예상치 못한 부작용
- 빌드 시간 증가

**권장 조치**: 종속성 구조를 단순화하고 더 평평한 구조로 리팩토링하는 것을 고려하세요.

### 자동 수정 가능한 문제

자동 수정 가능한 문제는 도구가 자동으로 수정할 수 있는 문제입니다. 현재 다음 유형의 문제를 자동으로 수정할 수 있습니다:

- 사용되지 않는 import 문
- 빈 파일 또는 거의 비어있는 파일 식별

**권장 조치**: `--fix` 옵션을 사용하여 이러한 문제를 자동으로 수정하세요.

## 모범 사례

### 정기적인 감사

모듈 감사를 정기적으로 실행하여 코드베이스의 건강 상태를 모니터링하세요. CI/CD 파이프라인에 통합하는 것이 좋습니다.

### 임계값 조정

프로젝트의 요구 사항에 맞게 임계값을 조정하세요. 모든 프로젝트가 동일한 기준을 가질 필요는 없습니다.

### 팀과 결과 공유

감사 결과를 팀과 공유하고 개선 계획을 함께 수립하세요. 코드 품질은 팀 전체의 책임입니다.

## 자동 수정 제한사항

자동 수정 기능은 다음과 같은 제한사항이 있습니다:

- 복잡한 문제는 자동으로 수정할 수 없습니다.
- 일부 수정은 컨텍스트에 따라 적절하지 않을 수 있습니다.
- 자동 수정 후에도 코드 리뷰가 필요합니다.

## CI/CD 통합

모듈 감사를 CI/CD 파이프라인에 통합하려면 다음과 같이 설정할 수 있습니다:

```yaml
# GitHub Actions 예시
jobs:
  module-audit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: yarn install
      - run: node scripts/module-audit.js
      # 심각한 문제가 있을 경우 빌드 실패
```

## 문제 해결

### Q: 모듈 감사가 너무 오래 걸립니다.
A: 큰 코드베이스에서는 시간이 오래 걸릴 수 있습니다. 특정 디렉터리만 분석하거나 더 작은 단위로 나누어 실행해 보세요.

### Q: 실제로 사용 중인 모듈이 '사용되지 않음'으로 표시됩니다.
A: 동적 임포트나 특별한 패턴을 사용하는 경우 발생할 수 있습니다. 이러한 경우 해당 모듈을 무시하거나 스크립트를 수정하여 특정 패턴을 인식하도록 할 수 있습니다.

### Q: 자동 수정이 제대로 작동하지 않습니다.
A: ESLint 설정이 올바른지 확인하세요. 또한 일부 복잡한 문제는 자동으로 수정할 수 없을 수 있습니다.

## 라이선스

이 도구는 Loop 프로젝트의 일부로 제공되며, 프로젝트의 라이선스를 따릅니다.

## 기여 방법

모듈 감사 도구에 기여하고 싶다면 GitHub 저장소에 이슈를 제출하거나 풀 리퀘스트를 제출하세요. 