"use strict";(()=>{var e={};e.id=518,e.ids=[518],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{e.exports=require("path")},44705:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>m,serverHooks:()=>y,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>u});var o=r(96559),i=r(48088),a=r(37719),n=r(32190),p=r(79748),d=r(33873),l=r(90151);async function u(e){try{let{searchParams:t}=new URL(e.url),r={type:t.get("type")||void 0,startTime:t.get("startTime")?parseInt(t.get("startTime")||"0"):void 0,endTime:t.get("endTime")?parseInt(t.get("endTime")||"0"):void 0,query:t.get("query")||void 0,limit:t.get("limit")?parseInt(t.get("limit")||"100"):100,offset:t.get("offset")?parseInt(t.get("offset")||"0"):0,sessionId:t.get("sessionId")||void 0},s=t.getAll("tag");s.length>0&&(r.tags=s);let o=t.getAll("type");o.length>1&&(r.type=o);let i=await c(r);return n.NextResponse.json({success:!0,count:i.length,data:i})}catch(e){return console.error("로그 검색 중 오류:",e),n.NextResponse.json({success:!1,error:e instanceof Error?e.message:"로그 검색 중 알 수 없는 오류가 발생했습니다."},{status:500})}}async function c(e){try{let t=Array.isArray(e.type)?e.type:e.type?[e.type]:Object.values(l.FY),r=[];for(let s of t){let t=(0,d.join)(process.cwd(),"public","logs",s);try{for(let s of(await (0,p.readdir)(t)).filter(t=>{if(!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;if(e.startTime||e.endTime){let[r,s,o]=t.split("-").map(Number),i=new Date(r,s-1,o).getTime();if(e.startTime&&i<e.startTime||e.endTime&&i>e.endTime)return!1}return!0})){let o=(0,d.join)(t,s);try{for(let t of(await (0,p.readdir)(o)))if(t.endsWith(".json"))try{let s=await (0,p.readFile)((0,d.join)(o,t),"utf-8"),i=JSON.parse(s);if(e.startTime&&i.timestamp<e.startTime||e.endTime&&i.timestamp>e.endTime||e.sessionId&&i.sessionId!==e.sessionId||e.tags&&e.tags.length>0&&(!i.tags||!e.tags.some(e=>i.tags?.includes(e))))continue;if(e.query){let t=e.query.toLowerCase(),r=(i.content||"").toLowerCase(),s=i.metadata?JSON.stringify(i.metadata).toLowerCase():"";if(!r.includes(t)&&!s.includes(t))continue}r.push(i)}catch(e){console.error(`로그 파일 읽기 오류 (${t}):`,e)}}catch(e){console.error(`날짜 디렉토리 처리 중 오류 (${s}):`,e)}}}catch(e){console.error(`타입 디렉토리 처리 중 오류 (${s}):`,e)}}r.sort((e,t)=>t.timestamp-e.timestamp);let s=e.offset||0,o=e.limit||100;return r.slice(s,s+o)}catch(e){throw console.error("파일 시스템 로그 검색 중 오류:",e),e}}let m=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/logs/search/route",pathname:"/api/logs/search",filename:"route",bundlePath:"app/api/logs/search/route"},resolvedPagePath:"C:\\Users\\user\\Desktop\\loop\\src\\app\\api\\logs\\search\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:g,workUnitAsyncStorage:f,serverHooks:y}=m;function h(){return(0,a.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:f})}},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79748:e=>{e.exports=require("fs/promises")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,483],()=>r(44705));module.exports=s})();