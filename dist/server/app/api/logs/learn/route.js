"use strict";(()=>{var e={};e.id=144,e.ids=[144],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},48866:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>R,routeModule:()=>f,serverHooks:()=>v,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>E});var s={};r.r(s),r.d(s,{GET:()=>g,POST:()=>h});var n=r(96559),a=r(48088),o=r(37719),i=r(32190),l=r(90151),u=r(11519),p=function(e){return e.MEMORY_OPTIMIZATION="memory_optimization",e.ERROR_PREDICTION="error_prediction",e.PERFORMANCE_OPTIMIZATION="performance_optimization",e.USER_BEHAVIOR="user_behavior",e}({});async function c(e={}){try{u.vF.info("메모리 사용 패턴 학습 시작");let t=e.minSampleSize||50,r=Date.now(),s=e.timeRange?.startTime||r-6048e5,n=e.timeRange?.endTime||r,a=await (0,l.gq)({type:l.FY.MEMORY,startTime:s,endTime:n,limit:1e3});a.length<t&&u.vF.warn(`충분한 메모리 로그 샘플이 없습니다. 필요: ${t}, 현재: ${a.length}`);let o=a.map(e=>{let t=e.metadata||{};return{timestamp:e.timestamp,heapUsed:t.heapUsed||0,heapTotal:t.heapTotal||0,percentUsed:t.percentUsed||0}}),i={};o.forEach(e=>{let t=new Date(e.timestamp).getHours();i[t]||(i[t]=[]),i[t].push(e.percentUsed)});let p=Object.entries(i).map(([e,t])=>({hour:parseInt(e),avgUsage:t.reduce((e,t)=>e+t,0)/t.length,count:t.length}));p.sort((e,t)=>t.avgUsage-e.avgUsage);let c=p.slice(0,3),m={};a.forEach(e=>{if(!e.sessionId)return;let t=e.metadata||{};m[e.sessionId]||(m[e.sessionId]=[]),m[e.sessionId].push(t.percentUsed||0)});let d=Object.entries(m).map(([e,t])=>{if(t.length<5)return null;let r=t.slice(0,Math.floor(t.length/2)),s=t.slice(Math.floor(t.length/2)),n=r.reduce((e,t)=>e+t,0)/r.length,a=s.reduce((e,t)=>e+t,0)/s.length-n;return{sessionId:e,samplesCount:t.length,increaseTrend:a,percentIncrease:a/n*100}}).filter(Boolean);d.sort((e,t)=>(t?.increaseTrend||0)-(e?.increaseTrend||0));let h=d.filter(e=>e&&e.percentIncrease>15),g=[];if(c.length>0){let e=c.map(e=>`${e.hour}시`).join(", ");g.push(`메모리 사용량이 높은 시간대(${e})에 자동 메모리 최적화를 예약하세요.`)}h.length>0&&(g.push(`메모리 누수 가능성이 있는 ${h.length}개의 패턴이 발견되었습니다.`),h.length>2&&g.push("장기간 사용 시 주기적인 앱 재시작 일정을 설정하세요."));let f=function(e){if(e.length<10)return null;e.map(e=>e.timestamp),e.map(e=>e.percentUsed);let t=e.map((e,t)=>({timestamp:e.timestamp,value:e.percentUsed})).sort((e,t)=>e.timestamp-t.timestamp),r=[];for(let e=1;e<t.length;e++){let s=t[e].timestamp-t[e-1].timestamp,n=t[e].value-t[e-1].value;n>0&&s>0&&r.push({rate:n/s*1e3,timeDiff:s})}if(r.length<5)return null;r.sort((e,t)=>e.rate-t.rate);let s=r[Math.floor(r.length/2)].rate,n=Math.round(5/s*800);return n<1e4?1e4:n>3e5?3e5:n}(o);f&&g.push(`최적의 가비지 컬렉션 주기: ${f}ms`);let y={modelType:"memory_optimization",timestamp:Date.now(),insights:[{type:"peakHours",data:c},{type:"problematicSessions",data:h.slice(0,5)},{type:"hourlyUsage",data:p}],recommendations:g,metrics:{sampleSize:a.length,avgMemoryUsage:o.reduce((e,t)=>e+t.percentUsed,0)/o.length,peakMemoryUsage:Math.max(...o.map(e=>e.percentUsed)),problematicSessionsCount:h.length}};return u.vF.info("메모리 사용 패턴 학습 완료",{sampleSize:a.length,recommendations:g.length}),y}catch(e){throw u.vF.error("메모리 사용 패턴 학습 중 오류:",e),e}}async function m(e={}){try{u.vF.info("사용자 행동 패턴 학습 시작");let t=e.minSampleSize||20,r=Date.now(),s=e.timeRange?.startTime||r-2592e6,n=e.timeRange?.endTime||r,a=await (0,l.gq)({type:l.FY.CONVERSATION,startTime:s,endTime:n,limit:1e3});a.length<t&&u.vF.warn(`충분한 대화 로그 샘플이 없습니다. 필요: ${t}, 현재: ${a.length}`);let o=a.map(e=>{try{return{...e,parsedContent:JSON.parse(e.content)}}catch(t){return{...e,parsedContent:{userMessage:"",aiResponse:"",timestamp:e.timestamp}}}}),i={};o.forEach(e=>{let t=e.parsedContent?.userMessage||"";t&&t.toLowerCase().replace(/[^\w\s가-힣]/g," ").split(/\s+/).filter(e=>e.length>1).forEach(e=>{i[e]=(i[e]||0)+1})});let p={};o.forEach(e=>{let t=e.timestamp||e.parsedContent?.timestamp;if(!t)return;let r=new Date(t).getHours();p[r]=(p[r]||0)+1});let c=o.map(e=>(e.parsedContent?.userMessage||"").length),m=c.length>0?c.reduce((e,t)=>e+t,0)/c.length:0,d={};o.forEach(e=>{e.sessionId&&(d[e.sessionId]=(d[e.sessionId]||0)+1)});let h=Object.entries(d).map(([e,t])=>({id:e,count:t})),g=h.length>0?h.reduce((e,t)=>e+(t&&t.count?t.count:0),0)/h.length:0,f=Object.entries(p).sort((e,t)=>null===e||null===t||null===e[1]||null===t[1]?0:t[1]-e[1]).slice(0,3).map(([e,t])=>({hour:parseInt(e),count:t})),y=[];if(f.length>0){let e=f.map(e=>`${e.hour}시`).join(", ");y.push(`사용자는 ${e}에 가장 활발하게 활동합니다. 이 시간대에 성능을 최적화하세요.`)}if(m>100?y.push(`사용자는 평균 ${Math.round(m)}자의 긴 메시지를 보냅니다. 대용량 텍스트 처리를 최적화하세요.`):y.push(`사용자는 평균 ${Math.round(m)}자의 짧은 메시지를 보냅니다. 빠른 응답에 집중하세요.`),g>10&&y.push(`사용자는 세션당 평균 ${Math.round(g)}개의 대화를 나눕니다. 장기 세션 메모리 관리를 최적화하세요.`),Object.keys(i).length>0){let e=Object.entries(i).sort((e,t)=>t[1]-e[1]).slice(0,20).map(([e,t])=>({word:e,count:t})).slice(0,3).map(e=>e.word).join(", ");y.push(`가장 자주 사용된 키워드는 "${e}"입니다. 이와 관련된 응답을 최적화하세요.`)}let E={modelType:"user_behavior",timestamp:Date.now(),insights:[{type:"topWords",data:Object.entries(i).sort((e,t)=>t[1]-e[1]).slice(0,20).map(([e,t])=>({word:e,count:t}))},{type:"activeHours",data:f},{type:"messageLengths",data:{average:m,max:Math.max(...c)}},{type:"sessionsActivity",data:{average:g,maxCount:Math.max(...Object.values(d).map(e=>e))}}],recommendations:y||[],metrics:{sampleSize:o.length,uniqueWords:Object.keys(i).length,avgMessageLength:m,avgConversationsPerSession:g}};return u.vF.info("사용자 행동 패턴 학습 완료",{sampleSize:o.length,recommendations:y?y.length:0}),E}catch(e){throw u.vF.error("사용자 행동 패턴 학습 중 오류:",e),e}}async function d(e={}){try{u.vF.info("오류 패턴 학습 시작");let t=e.minSampleSize||10,r=Date.now(),s=e.timeRange?.startTime||r-2592e6,n=e.timeRange?.endTime||r,a=await (0,l.gq)({type:l.FY.ERROR,startTime:s,endTime:n,limit:1e3});a.length<t&&u.vF.warn(`충분한 오류 로그 샘플이 없습니다. 필요: ${t}, 현재: ${a.length}`);let o={};a.forEach(e=>{var t;let r=e.content||"",s=(t=r).includes("TypeError:")?"TypeError":t.includes("ReferenceError:")?"ReferenceError":t.includes("SyntaxError:")?"SyntaxError":t.includes("RangeError:")?"RangeError":t.includes("NetworkError:")||t.includes("네트워크")?"NetworkError":t.includes("API 요청 실패")||t.includes("API request failed")?"APIError":t.includes("Permission denied")||t.includes("권한")?"PermissionError":t.includes("not found")||t.includes("찾을 수 없음")?"NotFoundError":t.includes("메모리")||t.includes("memory")?"MemoryError":t.includes("undefined")||t.includes("null")?"NullError":t.includes("promise")||t.includes("async")?"AsyncError":t.includes("초과")||t.includes("limit")||t.includes("threshold")?"LimitExceededError":"UnknownError";o[s]||(o[s]={count:0,examples:[],sessionIds:new Set}),o[s].count++,o[s].examples.length<5&&o[s].examples.push({message:r,timestamp:e.timestamp}),e.sessionId&&o[s].sessionIds.add(e.sessionId)});let i=Object.entries(o).map(([e,t])=>({type:e,count:t.count,examples:t.examples,uniqueSessions:t.sessionIds.size})).sort((e,t)=>t.count-e.count),p={};a.forEach(e=>{let t=new Date(e.timestamp).getHours();p[t]=(p[t]||0)+1});let c=Object.entries(p).sort((e,t)=>t[1]-e[1]).slice(0,3).map(([e,t])=>({hour:parseInt(e),count:t})),m=[];if(i.length>0){let e=i[0];m.push(`가장 빈번한 오류 "${e.type}"에 대한 예외 처리를 강화하세요. (${e.count}회 발생)`),e.uniqueSessions>3&&m.push(`"${e.type}" 오류가 ${e.uniqueSessions}개의 다른 세션에서 발생했습니다. 시스템적 문제일 가능성이 있습니다.`)}if(c.length>0){let e=c.map(e=>`${e.hour}시`).join(", ");m.push(`${e}에 오류 발생률이 높습니다. 이 시간대에 추가 모니터링을 설정하세요.`)}if(a.length>50){let e=(a.length/((n-s)/864e5)).toFixed(2);m.push(`일평균 ${e}개의 오류가 발생합니다. 오류 처리 로직을 검토하세요.`)}let d={modelType:"error_prediction",timestamp:Date.now(),insights:[{type:"topErrors",data:i.slice(0,5)},{type:"errorPeakHours",data:c},{type:"errorDistribution",data:Object.fromEntries(i.slice(0,10).map(e=>[e.type,e.count]))}],recommendations:m,metrics:{sampleSize:a.length,uniqueErrorTypes:Object.keys(o).length,mostFrequentErrorCount:i.length>0?i[0].count:0,errorVarietyIndex:Object.keys(o).length/a.length}};return u.vF.info("오류 패턴 학습 완료",{sampleSize:a.length,errorTypes:Object.keys(o).length}),d}catch(e){throw u.vF.error("오류 패턴 학습 중 오류:",e),e}}async function h(e){try{let{modelTypes:t,options:r}=await e.json();if(!t||!Array.isArray(t)||0===t.length)return i.NextResponse.json({success:!1,error:"학습할 모델 타입이 지정되지 않았습니다."},{status:400});let s=[],n=[];for(let e of t)try{let t;switch(e){case p.MEMORY_OPTIMIZATION:t=await c(r?.memory);break;case p.USER_BEHAVIOR:t=await m(r?.user);break;case p.ERROR_PREDICTION:t=await d(r?.error);break;default:n.push(`지원하지 않는 모델 타입: ${e}`);continue}s.push(t)}catch(t){console.error(`${e} 모델 학습 중 오류:`,t),n.push(`${e} 학습 오류: ${t instanceof Error?t.message:String(t)}`)}let a=[];return s.length>1&&(a=function(e){let t=e.flatMap(e=>e.recommendations),r=[],s=new Set;for(let e of t){let t=e.toLowerCase().replace(/[^\w\s가-힣]/g," ").split(/\s+/).filter(e=>e.length>4),n=!1;for(let e of t)if(s.has(e)){n=!0;break}n||(r.push(e),t.forEach(e=>s.add(e)))}return r}(s)),i.NextResponse.json({success:!0,results:s,combinedRecommendations:a.length>0?a:void 0,errors:n.length>0?n:void 0,timestamp:Date.now()})}catch(e){return console.error("로그 학습 중 오류:",e),i.NextResponse.json({success:!1,error:e instanceof Error?e.message:"로그 학습 중 알 수 없는 오류가 발생했습니다."},{status:500})}}async function g(){try{return i.NextResponse.json({success:!0,status:{isLearning:!1,lastLearningTime:null,availableModels:Object.values(p)}})}catch(e){return console.error("학습 상태 조회 중 오류:",e),i.NextResponse.json({success:!1,error:"학습 상태 조회 중 오류가 발생했습니다."},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/logs/learn/route",pathname:"/api/logs/learn",filename:"route",bundlePath:"app/api/logs/learn/route"},resolvedPagePath:"C:\\Users\\user\\Desktop\\loop\\src\\app\\api\\logs\\learn\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:E,serverHooks:v}=f;function R(){return(0,o.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:E})}},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580,483],()=>r(48866));module.exports=s})();